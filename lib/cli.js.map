{"version":3,"sources":["../src/cli.js"],"names":["babel","babelrc","JSON","parse","readFileSync","join","__dirname","launch","name","transform","code","plugins","filename","compile","input","args","Error","from","plugin","then","mp","js","out","writeFileSync","output","console","log","catch","error","version","usage","forEach","option","process","argv"],"mappings":";;;;AAAA;;;;AACA;;;;AACA;;IAAYA,K;;AACZ;;;;AAEA;;;;AACA;;;;AACA;;;;;;;;;;;;AAEA,IAAMC,UAAUC,KAAKC,KAAL,CAAW,aAAGC,YAAH,CAAgB,eAAKC,IAAL,CAAUC,SAAV,EAAqB,eAArB,CAAhB,EAAuD,OAAvD,CAAX,CAAhB;AACA,IAAMC,SAAS,SAATA,MAAS;AAAA,kEAA6DC,IAA7D;AAAA,CAAf;;AAEA,IAAMC,YAAY,SAAZA,SAAY,CAACC,IAAD,EAAOF,IAAP;AAAA,WAAgBR,MAAMS,SAAN,CAAgBC,IAAhB,eAA2BT,OAA3B,IAAoCU,SAAS,CAAC,8BAAD,CAA7C,EAA+EC,UAAUJ,IAAzF,IAAhB;AAAA,CAAlB;;AAEA,IAAMK,UAAU,SAAVA,OAAU,GAAM;AAClB,QAAMC,QAAQ,oBAAUC,IAAV,CAAe,CAAf,CAAd,CADkB,CACe;AACjC,QAAI,CAACD,KAAL,EAAY;AACR,cAAM,IAAIE,KAAJ,CAAU,qBAAV,CAAN;AACH;AACD,QAAMR,OAAO,oBAAUO,IAAV,CAAe,CAAf,CAAb;AACA,mBAASE,IAAT,CAAc,aAAGb,YAAH,CAAgBU,KAAhB,EAAuB,OAAvB,CAAd,EAA+CN,IAA/C,EAAqD,EAAEU,QAAQ,wBAAV,EAArD,EACKC,IADL,CACU;AAAA,4BAAYC,EAAZ,IAAgBV,MAAMU,GAAGV,IAAH,EAAtB;AAAA,KADV,EAEKS,IAFL,CAEU;AAAA,eAAM,oBAAUV,SAAV,gBAA4BW,EAA5B,EAAmCX,UAAUW,GAAGV,IAAb,EAAmBU,GAAGZ,IAAtB,CAAnC,IAAoEY,EAA1E;AAAA,KAFV,EAGKD,IAHL,CAGU;AAAA,YAAGT,IAAH,QAAGA,IAAH;AAAA,YAASF,IAAT,QAASA,IAAT;AAAA,YAAeU,MAAf,QAAeA,MAAf;AAAA,eAA4B,oBAAUG,EAAV,GAAeX,IAAf,GAAsB,6BACjDQ,OAAO,MAAP,CADiD,mBAEvCR,IAFuC,kBAGpDH,OAAOC,IAAP,CAHoD,EAIpD,EAJoD,GAKtDH,IALsD,CAKjD,IALiD,CAAlD;AAAA,KAHV,EASKc,IATL,CASU;AAAA,eACF,oBAAUG,GAAV,GACI,aAAGC,aAAH,CAAiB,oBAAUD,GAA3B,EAAgCE,MAAhC,EAAwC,OAAxC,CADJ,GAEMC,QAAQC,GAAR,CAAYF,MAAZ,CAHJ;AAAA,KATV,CAYkC;AAZlC,MAaMG,KAbN,CAaYF,QAAQG,KAbpB,EANkB,CAmBU;AAC/B,CApBD;;AAsBA,oBAAUC,OAAV,CAAkB,kBAAIA,OAAtB,EAA+BC,KAA/B,CAAqC,4BAArC;AACA,CACI,CAAC,QAAD,EAAW,iBAAX,CADJ,EAEI,CAAC,MAAD,EAAS,uBAAT,CAFJ,EAGI,CAAC,kBAAD,EAAqB,iCAArB,CAHJ,EAII,CAAC,gBAAD,EAAmB,2BAAnB,CAJJ,EAKEC,OALF,CAKU;AAAA;AAAA,QAAKhB,IAAL;;AAAA,WAAe,oBAAUiB,MAAV,+CAAoBjB,IAApB,EAAf;AAAA,CALV;AAMA,oBAAUZ,KAAV,CAAgB8B,QAAQC,IAAxB;;AAEArB","file":"cli.js","sourcesContent":["import fs from 'fs';\r\nimport path from 'path';\r\nimport * as babel from 'babel-core';\r\nimport commander from 'commander';\r\n\r\nimport pkg from './../package.json';\r\nimport Markplus from './core';\r\nimport PluginStyleDefault from './plugin/style-default';\r\n\r\nconst babelrc = JSON.parse(fs.readFileSync(path.join(__dirname, './../.babelrc'), 'utf-8'));\r\nconst launch = name => `<div id=\"markplus\" class=\"Markplus\"></div><script>${name}.default(document.querySelector('#markplus'));</script>`;\r\n\r\nconst transform = (code, name) => babel.transform(code, { ...babelrc, plugins: ['transform-es2015-modules-umd'], filename: name });\r\n\r\nconst compile = () => {\r\n    const input = commander.args[0]; // eslint-disable-line no-console\r\n    if (!input) {\r\n        throw new Error('missing input file.');\r\n    }\r\n    const name = commander.args[1];\r\n    Markplus.from(fs.readFileSync(input, 'utf-8'), name, { plugin: [PluginStyleDefault] })\r\n        .then(mp => ({ ...mp, code: mp.code() }))\r\n        .then(mp => commander.transform ? ({ ...mp, ...transform(mp.code, mp.name) }) : mp)\r\n        .then(({ code, name, plugin }) => commander.js ? code : [\r\n            ...plugin('head'),\r\n            `<script>\\n${code}\\n</script>`,\r\n            launch(name),\r\n            '',\r\n        ].join('\\n'))\r\n        .then(output =>\r\n            commander.out ?\r\n                fs.writeFileSync(commander.out, output, 'utf-8')\r\n                : console.log(output) // eslint-disable-line no-console\r\n        ).catch(console.error); // eslint-disable-line no-console\r\n};\r\n\r\ncommander.version(pkg.version).usage('[options] INPUT <name> ...');\r\n[\r\n    ['--html', 'Compile to html'],\r\n    ['--js', 'Compile to javascript'],\r\n    ['-o, --out [file]', 'Write the output into the file.'],\r\n    ['--no-transform', 'With out babel transform.'],\r\n].forEach(([...args]) => commander.option(...args));\r\ncommander.parse(process.argv);\r\n\r\ncompile();\r\n"]}